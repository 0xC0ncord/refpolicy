# Copyright (C) 2005 Tresys Technology, LLC

#######################################
#
# corenetwork_network_tcp_on_general_interface(domain,[`optional'])
#
define(`corenetwork_network_tcp_on_general_interface',`
requires_block_template(`corenetwork_network_tcp_on_general_interface_depend',$2)
allow $1 netif_t:netif { tcp_send tcp_recv };
')

define(`corenetwork_network_tcp_on_general_interface_depend',`
type netif_t;
class netif { tcp_send tcp_recv };
')

#######################################
#
# corenetwork_network_udp_on_general_interface(domain,[`optional'])
#
define(`corenetwork_network_udp_on_general_interface',`
requires_block_template(`corenetwork_network_udp_on_general_interface_depend',$2)
corenetwork_send_udp_on_general_interface($1,$2)
corenetwork_receive_udp_on_general_interface($1,$2)
')

define(`corenetwork_network_udp_on_general_interface_depend',`
corenetwork_send_udp_on_general_interface_depend
corenetwork_receive_udp_on_general_interface_depend
')

#######################################
#
# corenetwork_network_raw_on_general_interface(domain,[`optional'])
#
define(`corenetwork_network_raw_on_general_interface',`
requires_block_template(`corenetwork_network_raw_on_general_interface_depend',$2)
corenetwork_send_raw_on_general_interface($1,$2)
corenetwork_receive_raw_on_general_interface($1,$2)
')

define(`corenetwork_network_raw_on_general_interface_depend',`
corenetwork_send_raw_on_general_interface_depend
corenetwork_receive_raw_on_general_interface_depend
')

#######################################
#
# corenetwork_send_udp_on_general_interface(domain,[`optional'])
#
define(`corenetwork_send_udp_on_general_interface',`
requires_block_template(`corenetwork_send_udp_on_general_interface_depend',$2)
allow $1 netif_t:netif udp_send;
')

define(`corenetwork_send_udp_on_general_interface_depend',`
type netif_t;
class netif udp_send;
')

#######################################
#
# corenetwork_receive_udp_on_general_interface(domain,[`optional'])
#
define(`corenetwork_receive_udp_on_general_interface',`
requires_block_template(`corenetwork_receive_udp_on_general_interface_depend',$2)
allow $1 netif_t:netif udp_recv;
')

define(`corenetwork_receive_udp_on_general_interface_depend',`
type netif_t;
class netif udp_recv;
')

#######################################
#
# corenetwork_send_raw_on_general_interface(domain,[`optional'])
#
define(`corenetwork_send_raw_on_general_interface',`
requires_block_template(`corenetwork_send_raw_on_general_interface_depend',$2)
allow $1 netif_t:netif rawip_send;
allow $1 self:capability net_raw;
')

define(`corenetwork_send_raw_on_general_interface_depend',`
type netif_t;
class netif rawip_send;
class capability net_raw;
')

#######################################
#
# corenetwork_receive_raw_on_general_interface(domain,[`optional'])
#
define(`corenetwork_receive_raw_on_general_interface',`
requires_block_template(`corenetwork_receive_raw_on_general_interface_depend',$2)
allow $1 netif_t:netif rawip_recv;
')

define(`corenetwork_receive_raw_on_general_interface_depend',`
type netif_t;
class netif rawip_recv;
')

#######################################
#
# corenetwork_network_tcp_on_all_interfaces(domain,[`optional'])
#
define(`corenetwork_network_tcp_on_all_interfaces',`
requires_block_template(`corenetwork_network_tcp_on_all_interfaces_depend',$2)
allow $1 netif_type:netif { tcp_send tcp_recv };
')

define(`corenetwork_network_tcp_on_all_interfaces_depend',`
attribute netif_type;
class netif { tcp_send tcp_recv };
')

#######################################
#
# corenetwork_network_udp_on_all_interfaces(domain,[`optional'])
#
define(`corenetwork_network_udp_on_all_interfaces',`
requires_block_template(`corenetwork_network_udp_on_all_interfaces_depend',$2)
corenetwork_send_udp_on_all_interfaces($1,$2)
corenetwork_receive_udp_on_all_interfaces($1,$2)
')

define(`corenetwork_network_udp_on_all_interfaces_depend',`
corenetwork_send_udp_on_all_interfaces_depend
corenetwork_receive_udp_on_all_interfaces_depend
')

#######################################
#
# corenetwork_network_raw_on_all_interfaces(domain,[`optional'])
#
define(`corenetwork_network_raw_on_all_interfaces',`
requires_block_template(`corenetwork_network_raw_on_all_interfaces_depend',$2)
corenetwork_send_raw_on_all_interfaces($1,$2)
corenetwork_receive_raw_on_all_interfaces($1,$2)
')

define(`corenetwork_network_raw_on_all_interfaces_depend',`
corenetwork_send_raw_on_all_interfaces_depend
corenetwork_receive_raw_on_all_interfaces_depend
')

#######################################
#
# corenetwork_send_udp_on_all_interfaces(domain,[`optional'])
#
define(`corenetwork_send_udp_on_all_interfaces',`
requires_block_template(`corenetwork_send_udp_on_all_interfaces_depend',$2)
allow $1 netif_type:netif udp_send;
')

define(`corenetwork_send_udp_on_all_interfaces_depend',`
attribute netif_type;
class netif udp_send;
')

#######################################
#
# corenetwork_send_raw_on_all_interfaces(domain,[`optional'])
#
define(`corenetwork_send_raw_on_all_interfaces',`
requires_block_template(`corenetwork_send_raw_on_all_interfaces_depend',$2)
allow $1 netif_type:netif rawip_send;
allow $1 self:capability net_raw;
')

define(`corenetwork_send_raw_on_all_interfaces_depend',`
attribute netif_type;
class netif rawip_send;
class capability net_raw;
')

#######################################
#
# corenetwork_receive_udp_on_all_interfaces(domain,[`optional'])
#
define(`corenetwork_receive_udp_on_all_interfaces',`
requires_block_template(`corenetwork_receive_udp_on_all_interfaces_depend',$2)
allow $1 netif_type:netif udp_recv;
')

define(`corenetwork_receive_udp_on_all_interfaces_depend',`
attribute netif_type;
class netif udp_recv;
')

#######################################
#
# corenetwork_receive_raw_on_all_interfaces(domain,[`optional'])
#
define(`corenetwork_receive_raw_on_all_interfaces',`
requires_block_template(`corenetwork_receive_raw_on_all_interfaces_depend',$2)
allow $1 netif_type:netif rawip_recv;
')

define(`corenetwork_receive_raw_on_all_interfaces_depend',`
attribute netif_type;
class netif rawip_recv;
')

#######################################
#
# corenetwork_network_tcp_on_general_node(domain,[`optional'])
#
define(`corenetwork_network_tcp_on_general_node',`
requires_block_template(`corenetwork_network_tcp_on_general_node_depend',$2)
allow $1 node_t:node { tcp_send tcp_recv };
')

define(`corenetwork_network_tcp_on_general_node_depend',`
type node_t;
class node { tcp_send tcp_recv };
')

#######################################
#
# corenetwork_network_udp_on_general_node(domain,[`optional'])
#
define(`corenetwork_network_udp_on_general_node',`
requires_block_template(`corenetwork_network_udp_on_general_node_depend',$2)
corenetwork_send_udp_on_general_node($1,$2)
corenetwork_receive_udp_on_general_node($1,$2)
')

define(`corenetwork_network_udp_on_general_node_depend',`
corenetwork_send_udp_on_general_node_depend
corenetwork_receive_udp_on_general_node_depend
')

#######################################
#
# corenetwork_network_raw_on_general_node(domain,[`optional'])
#
define(`corenetwork_network_raw_on_general_node',`
requires_block_template(`corenetwork_network_raw_on_general_node_depend',$2)
corenetwork_send_raw_on_general_node($1,$2)
corenetwork_receive_raw_on_general_node($1,$2)
')

define(`corenetwork_network_raw_on_general_node_depend',`
corenetwork_send_raw_on_general_node_depend
corenetwork_receive_raw_on_general_node_depend
')

#######################################
#
# corenetwork_send_udp_on_general_node(domain,[`optional'])
#
define(`corenetwork_send_udp_on_general_node',`
requires_block_template(`corenetwork_send_udp_on_general_node_depend',$2)
allow $1 node_t:node udp_send;
')

define(`corenetwork_send_udp_on_general_node_depend',`
type node_t;
class node udp_send;
')

#######################################
#
# corenetwork_receive_udp_on_general_node(domain,[`optional'])
#
define(`corenetwork_receive_udp_on_general_node',`
requires_block_template(`corenetwork_receive_udp_on_general_node_depend',$2)
allow $1 node_t:node udp_recv;
')

define(`corenetwork_receive_udp_on_general_node_depend',`
type node_t;
class node udp_recv;
')

#######################################
#
# corenetwork_send_raw_on_general_node(domain,[`optional'])
#
define(`corenetwork_send_raw_on_general_node',`
requires_block_template(`corenetwork_send_raw_on_general_node_depend',$2)
allow $1 node_t:node rawip_send;
allow $1 self:capability net_raw;
')

define(`corenetwork_send_raw_on_general_node_depend',`
type node_t;
class node rawip_send;
class capability net_raw;
')

#######################################
#
# corenetwork_receive_raw_on_general_node(domain,[`optional'])
#
define(`corenetwork_receive_raw_on_general_node',`
requires_block_template(`corenetwork_receive_raw_on_general_node_depend',$2)
allow $1 node_t:node rawip_recv;
')

define(`corenetwork_receive_raw_on_general_node_depend',`
type node_t;
class node rawip_recv;
')

#######################################
#
# corenetwork_bind_tcp_on_general_node(domain,[`optional'])
#
define(`corenetwork_bind_tcp_on_general_node',`
requires_block_template(`corenetwork_bind_tcp_on_general_node_depend',$2)
allow $1 node_t:tcp_socket node_bind;
')

define(`corenetwork_bind_udp_on_general_node_depend',`
type node_t;
class tcp_socket node_bind;
')

#######################################
#
# corenetwork_bind_udp_on_general_node(domain,[`optional'])
#
define(`corenetwork_bind_udp_on_general_node',`
requires_block_template(`corenetwork_bind_udp_on_general_node_depend',$2)
allow $1 node_t:udp_socket node_bind;
')

define(`corenetwork_bind_udp_on_general_node_depend',`
type node_t;
class udp_socket node_bind;
')

#######################################
#
# corenetwork_network_tcp_on_all_nodes(domain,[`optional'])
#
define(`corenetwork_network_tcp_on_all_nodes',`
requires_block_template(`corenetwork_network_tcp_on_all_nodes_depend',$2)
allow $1 node_type:node { tcp_send tcp_recv };
')

define(`corenetwork_network_tcp_on_all_nodes_depend',`
attribute node_type;
class node { tcp_send tcp_recv };
')

#######################################
#
# corenetwork_network_udp_on_all_nodes(domain,[`optional'])
#
define(`corenetwork_network_udp_on_all_nodes',`
requires_block_template(`corenetwork_network_udp_on_all_nodes_depend',$2)
corenetwork_send_udp_on_all_nodes($1,optional)
corenetwork_receive_udp_on_all_nodes($1,optional)
')

define(`corenetwork_network_udp_on_all_nodes_depend',`
corenetwork_send_udp_on_all_nodes_depend
corenetwork_receive_udp_on_all_nodes_depend
')

#######################################
#
# corenetwork_network_raw_on_all_nodes(domain,[`optional'])
#
define(`corenetwork_network_raw_on_all_nodes',`
requires_block_template(`corenetwork_network_raw_on_all_nodes_depend',$2)
corenetwork_send_raw_on_all_nodes($1,optional)
corenetwork_receive_raw_on_all_nodes($1,optional)
')

define(`corenetwork_network_raw_on_all_nodes_depend',`
corenetwork_send_raw_on_all_nodes_depend
corenetwork_receive_raw_on_all_nodes_depend
')

#######################################
#
# corenetwork_send_udp_on_all_nodes(domain,[`optional'])
#
define(`corenetwork_send_udp_on_all_nodes',`
requires_block_template(`corenetwork_send_udp_on_all_nodes_depend',$2)
allow $1 node_type:node udp_send;
')

define(`corenetwork_send_udp_on_all_nodes_depend',`
attribute node_type;
class node udp_send;
')

#######################################
#
# corenetwork_receive_udp_on_all_nodes(domain,[`optional'])
#
define(`corenetwork_receive_udp_on_all_nodes',`
requires_block_template(`corenetwork_receive_udp_on_all_nodes_depend',$2)
allow $1 node_type:node udp_recv;
')

define(`corenetwork_receive_udp_on_all_nodes_depend',`
attribute node_type;
class node udp_recv;
')

#######################################
#
# corenetwork_send_raw_on_all_nodes(domain,[`optional'])
#
define(`corenetwork_send_raw_on_all_nodes',`
requires_block_template(`corenetwork_send_raw_on_all_nodes_depend',$2)
allow $1 node_type:node rawip_send;
allow $1 self:capability net_raw;
')

define(`corenetwork_send_raw_on_all_nodes_depend',`
attribute node_type;
class node rawip_send;
class capability net_raw;
')

#######################################
#
# corenetwork_receive_raw_on_all_nodes(domain,[`optional'])
#
define(`corenetwork_receive_raw_on_all_nodes',`
requires_block_template(`corenetwork_receive_raw_on_all_nodes_depend',$2)
allow $1 node_type:node rawip_recv;
')

define(`corenetwork_receive_raw_on_all_nodes_depend',`
attribute node_type;
class node rawip_recv;
')

#######################################
#
# corenetwork_bind_tcp_on_all_nodes(domain,[`optional'])
#
define(`corenetwork_bind_tcp_on_all_nodes',`
requires_block_template(`corenetwork_bind_tcp_on_all_nodes_depend',$2)
allow $1 node_type:tcp_socket node_bind;
')

define(`corenetwork_bind_udp_on_all_nodes_depend',`
type node_type;
class tcp_socket node_bind;
')

#######################################
#
# corenetwork_bind_udp_on_all_nodes(domain,[`optional'])
#
define(`corenetwork_bind_udp_on_all_nodes',`
requires_block_template(`corenetwork_bind_udp_on_all_nodes_depend',$2)
allow $1 node_type:udp_socket node_bind;
')

define(`corenetwork_bind_udp_on_all_nodes_depend',`
type node_type;
class udp_socket node_bind;
')

#######################################
#
# corenetwork_network_tcp_on_general_port(domain,[`optional'])
#
define(`corenetwork_network_tcp_on_general_port',`
requires_block_template(`corenetwork_network_tcp_on_general_port_depend',$2)
allow $1 port_t:tcp_socket { send_msg recv_msg };
')

define(`corenetwork_network_tcp_on_general_port_depend',`
type port_t;
class tcp_socket { send_msg recv_msg };
')

#######################################
#
# corenetwork_network_udp_on_general_port(domain,[`optional'])
#
define(`corenetwork_network_udp_on_general_port',`
requires_block_template(`corenetwork_network_udp_on_general_port_depend',$2)
corenetwork_send_udp_on_general_port($1,$2)
corenetwork_receive_udp_on_general_port($1,$2)
')

define(`corenetwork_network_udp_on_general_port_depend',`
corenetwork_send_udp_on_general_port_depend
corenetwork_receive_udp_on_general_port_depend
')

#######################################
#
# corenetwork_send_udp_on_general_port(domain,[`optional'])
#
define(`corenetwork_send_udp_on_general_port',`
requires_block_template(`corenetwork_send_udp_on_general_port_depend',$2)
allow $1 port_t:udp_socket send_msg;
')

define(`corenetwork_send_udp_on_general_port_depend',`
type port_t;
class udp_socket send_msg;
')

#######################################
#
# corenetwork_receive_udp_on_general_port(domain,[`optional'])
#
define(`corenetwork_receive_udp_on_general_port',`
requires_block_template(`corenetwork_receive_udp_on_general_port_depend',$2)
allow $1 port_t:udp_socket recv_msg;
')

define(`corenetwork_receive_udp_on_general_port_depend',`
type port_t;
class udp_socket recv_msg;
')

#######################################
#
# corenetwork_bind_tcp_on_general_port(domain,[`optional'])
#
define(`corenetwork_bind_tcp_on_general_port',`
requires_block_template(`corenetwork_bind_tcp_on_general_port_depend',$2)
allow $1 port_t:tcp_socket name_bind;
')

define(`corenetwork_bind_udp_on_general_port_depend',`
type port_t;
class tcp_socket name_bind;
')

#######################################
#
# corenetwork_bind_udp_on_general_port(domain,[`optional'])
#
define(`corenetwork_bind_udp_on_general_port',`
requires_block_template(`corenetwork_bind_udp_on_general_port_depend',$2)
allow $1 port_t:udp_socket name_bind;
')

define(`corenetwork_bind_udp_on_general_port_depend',`
type port_t;
class udp_socket name_bind;
')

#######################################
#
# corenetwork_network_tcp_on_all_ports(domain,[`optional'])
#
define(`corenetwork_network_tcp_on_all_ports',`
requires_block_template(`corenetwork_network_tcp_on_all_ports_depend',$2)
allow $1 port_type:tcp_socket { send_msg recv_msg };
')

define(`corenetwork_network_tcp_on_all_ports_depend',`
attribute port_type;
class tcp_socket { send_msg recv_msg };
')

#######################################
#
# corenetwork_network_udp_on_all_ports(domain,[`optional'])
#
define(`corenetwork_network_udp_on_all_ports',`
requires_block_template(`corenetwork_network_udp_on_all_ports_depend',$2)
corenetwork_send_udp_on_all_ports($1,optional)
corenetwork_receive_udp_on_all_ports($1,optional)
')

define(`corenetwork_network_udp_on_all_ports_depend',`
corenetwork_send_udp_on_all_ports_depend
corenetwork_receive_udp_on_all_ports_depend
')

#######################################
#
# corenetwork_send_udp_on_all_ports(domain,[`optional'])
#
define(`corenetwork_send_udp_on_all_ports',`
requires_block_template(`corenetwork_send_udp_on_all_ports_depend',$2)
allow $1 port_type:udp_socket send_msg;
')

define(`corenetwork_send_udp_on_all_ports_depend',`
attribute port_type;
class udp_socket send_msg;
')

#######################################
#
# corenetwork_receive_udp_on_all_ports(domain,[`optional'])
#
define(`corenetwork_receive_udp_on_all_ports',`
requires_block_template(`corenetwork_receive_udp_on_all_ports_depend',$2)
allow $1 port_type:udp_socket recv_msg;
')

define(`corenetwork_receive_udp_on_all_ports_depend',`
attribute port_type;
class udp_socket recv_msg;
')

#######################################
#
# corenetwork_bind_tcp_on_all_ports(domain,[`optional'])
#
define(`corenetwork_bind_tcp_on_all_ports',`
requires_block_template(`corenetwork_bind_tcp_on_all_ports_depend',$2)
allow $1 port_type:tcp_socket name_bind;
')

define(`corenetwork_bind_udp_on_all_ports_depend',`
type port_type;
class tcp_socket name_bind;
')

#######################################
#
# corenetwork_bind_udp_on_all_ports(domain,[`optional'])
#
define(`corenetwork_bind_udp_on_all_ports',`
requires_block_template(`corenetwork_bind_udp_on_all_ports_depend',$2)
allow $1 port_type:udp_socket name_bind;
')

define(`corenetwork_bind_udp_on_all_ports_depend',`
type port_type;
class udp_socket name_bind;
')

#######################################
#
# corenetwork_network_tcp_on_reserved_port(domain,[`optional'])
#
define(`corenetwork_network_tcp_on_reserved_port',`
requires_block_template(`corenetwork_network_tcp_on_reserved_port_depend',$2)
allow $1 reserved_port_t:tcp_socket { send_msg recv_msg };
')

define(`corenetwork_network_tcp_on_reserved_port_depend',`
type reserved_port_t;
class tcp_socket { send_msg recv_msg };
')

#######################################
#
# corenetwork_network_udp_on_reserved_port(domain,[`optional'])
#
define(`corenetwork_network_udp_on_reserved_port',`
requires_block_template(`corenetwork_network_udp_on_reserved_port_depend',$2)
corenetwork_send_udp_on_reserved_port($1,$2)
corenetwork_receive_udp_on_reserved_port($1,$2)
')

define(`corenetwork_network_udp_on_reserved_port_depend',`
corenetwork_send_udp_on_reserved_port_depend
corenetwork_receive_udp_on_reserved_port_depend
')

#######################################
#
# corenetwork_send_udp_on_reserved_port(domain,[`optional'])
#
define(`corenetwork_send_udp_on_reserved_port',`
requires_block_template(`corenetwork_send_udp_on_reserved_port_depend',$2)
allow $1 reserved_port_t:udp_socket send_msg;
')

define(`corenetwork_send_udp_on_reserved_port_depend',`
type reserved_port_t;
class udp_socket send_msg;
')

#######################################
#
# corenetwork_receive_udp_on_reserved_port(domain,[`optional'])
#
define(`corenetwork_receive_udp_on_reserved_port',`
requires_block_template(`corenetwork_receive_udp_on_reserved_port_depend',$2)
allow $1 reserved_port_t:udp_socket recv_msg;
')

define(`corenetwork_receive_udp_on_reserved_port_depend',`
type reserved_port_t;
class udp_socket recv_msg;
')

#######################################
#
# corenetwork_bind_tcp_on_reserved_port(domain,[`optional'])
#
define(`corenetwork_bind_tcp_on_reserved_port',`
requires_block_template(`corenetwork_bind_tcp_on_reserved_port_depend',$2)
allow $1 reserved_port_t:tcp_socket name_bind;
allow $1 self:capability net_bind_service;
')

define(`corenetwork_bind_udp_on_reserved_port_depend',`
type reserved_port_t;
class tcp_socket name_bind;
class capability net_bind_service;
')

#######################################
#
# corenetwork_bind_udp_on_reserved_port(domain,[`optional'])
#
define(`corenetwork_bind_udp_on_reserved_port',`
requires_block_template(`corenetwork_bind_udp_on_reserved_port_depend',$2)
allow $1 reserved_port_t:udp_socket name_bind;
allow $1 self:capability net_bind_service;
')

define(`corenetwork_bind_udp_on_reserved_port_depend',`
type reserved_port_t;
class udp_socket name_bind;
class capability net_bind_service;
')

#######################################
#
# corenetwork_network_tcp_on_all_reserved_ports(domain,[`optional'])
#
define(`corenetwork_network_tcp_on_all_reserved_ports',`
requires_block_template(`corenetwork_network_tcp_on_all_reserved_ports_depend',$2)
allow $1 reserved_port_type:tcp_socket { send_msg recv_msg };
')

define(`corenetwork_network_tcp_on_all_reserved_ports_depend',`
attribute reserved_port_type;
class tcp_socket { send_msg recv_msg };
')

#######################################
#
# corenetwork_network_udp_on_all_reserved_ports(domain,[`optional'])
#
define(`corenetwork_network_udp_on_all_reserved_ports',`
requires_block_template(`corenetwork_network_udp_on_all_reserved_ports_depend',$2)
corenetwork_send_udp_on_all_reserved_ports($1,optional)
corenetwork_receive_udp_on_all_reserved_ports($1,optional)
')

define(`corenetwork_network_udp_on_all_reserved_ports_depend',`
corenetwork_send_udp_on_all_reserved_ports_depend
corenetwork_receive_udp_on_all_reserved_ports_depend
')

#######################################
#
# corenetwork_send_udp_on_all_reserved_ports(domain,[`optional'])
#
define(`corenetwork_send_udp_on_all_reserved_ports',`
requires_block_template(`corenetwork_send_udp_on_all_reserved_ports_depend',$2)
allow $1 reserved_port_type:udp_socket send_msg;
')

define(`corenetwork_send_udp_on_all_reserved_ports_depend',`
attribute reserved_port_type;
class udp_socket send_msg;
')

#######################################
#
# corenetwork_receive_udp_on_all_reserved_ports(domain,[`optional'])
#
define(`corenetwork_receive_udp_on_all_reserved_ports',`
requires_block_template(`corenetwork_receive_udp_on_all_reserved_ports_depend',$2)
allow $1 reserved_port_type:udp_socket recv_msg;
')

define(`corenetwork_receive_udp_on_all_reserved_ports_depend',`
attribute reserved_port_type;
class udp_socket recv_msg;
')

#######################################
#
# corenetwork_bind_tcp_on_all_reserved_ports(domain,[`optional'])
#
define(`corenetwork_bind_tcp_on_all_reserved_ports',`
requires_block_template(`corenetwork_bind_tcp_on_all_reserved_ports_depend',$2)
allow $1 reserved_port_type:tcp_socket name_bind;
allow $1 self:capability net_bind_service;
')

define(`corenetwork_bind_udp_on_all_reserved_ports_depend',`
type reserved_port_type;
class tcp_socket name_bind;
class capability net_bind_service;
')

#######################################
#
# corenetwork_bind_udp_on_all_reserved_ports(domain,[`optional'])
#
define(`corenetwork_bind_udp_on_all_reserved_ports',`
requires_block_template(`corenetwork_bind_udp_on_all_reserved_ports_depend',$2)
allow $1 reserved_port_type:udp_socket name_bind;
allow $1 self:capability net_bind_service;
')

define(`corenetwork_bind_udp_on_all_reserved_ports_depend',`
type reserved_port_type;
class udp_socket name_bind;
class self:capability net_bind_service;
')

########################################
#
# This section is processed through m4 to create real interfaces
#
########################################

# dont generate anything but macros on this pass
ifdef(`interface_pass',`
define(`allow',`dnl')
define(`type',`dnl')
define(`attribute',`dnl')
define(`portcon',`dnl')
define(`devices_make_device_node',`dnl')
')

########################################
#
# Network Interface generated macros 
#
########################################

define(`create_netif_interfaces',``
#######################################
#
# corenetwork_network_tcp_on_$1_interface(domain,[`optional'])
#
define(`corenetwork_network_tcp_on_$1_interface',`
requires_block_template(`corenetwork_network_tcp_on_$1_interface_depend',dollarstwo)
allow dollarsone $1_netif_t:netif { tcp_send tcp_recv };
')

define(`corenetwork_network_tcp_on_$1_interface_depend',`
type $1_netif_t;
class netif { tcp_send tcp_recv };
')

#######################################
#
# corenetwork_network_udp_on_$1_interface(domain,[`optional'])
#
define(`corenetwork_network_udp_on_$1_interface',`
requires_block_template(`corenetwork_network_udp_on_$1_interface_depend',dollarstwo)
corenetwork_send_udp_on_$1_interface(dollarsone,dollarstwo)
corenetwork_receive_udp_on_$1_interface(dollarsone,dollarstwo)
')

define(`corenetwork_network_udp_on_$1_interface_depend',`
corenetwork_send_udp_on_$1_interface_depend
corenetwork_receive_udp_on_$1_interface_depend
')

#######################################
#
# corenetwork_network_raw_on_$1_interface(domain,[`optional'])
#
define(`corenetwork_network_raw_on_$1_interface',`
requires_block_template(`corenetwork_network_raw_on_$1_interface_depend',dollarstwo)
corenetwork_send_raw_on_$1_interface(dollarsone,dollarstwo)
corenetwork_receive_raw_on_$1_interface(dollarsone,dollarstwo)
')

define(`corenetwork_network_raw_on_$1_interface_depend',`
corenetwork_send_raw_on_$1_interface_depend
corenetwork_receive_raw_on_$1_interface_depend
')

#######################################
#
# corenetwork_send_udp_on_$1_interface(domain,[`optional'])
#
define(`corenetwork_send_udp_on_$1_interface',`
requires_block_template(`corenetwork_send_udp_on_$1_interface_depend',dollarstwo)
allow dollarsone $1_netif_t:netif udp_send;
')

define(`corenetwork_send_udp_on_$1_interface_depend',`
type $1_netif_t;
class netif udp_send;
')

#######################################
#
# corenetwork_receive_udp_on_$1_interface(domain,[`optional'])
#
define(`corenetwork_receive_udp_on_$1_interface',`
requires_block_template(`corenetwork_receive_udp_on_$1_interface_depend',dollarstwo)
allow dollarsone $1_netif_t:netif udp_recv;
')

define(`corenetwork_receive_udp_on_$1_interface_depend',`
type $1_netif_t;
class netif udp_recv;
')

#######################################
#
# corenetwork_send_raw_on_$1_interface(domain,[`optional'])
#
define(`corenetwork_send_raw_on_$1_interface',`
requires_block_template(`corenetwork_send_raw_on_$1_interface_depend',dollarstwo)
allow dollarsone $1_netif_t:netif rawip_send;
allow dollarsone self:capability net_raw;
')

define(`corenetwork_send_raw_on_$1_interface_depend',`
type $1_netif_t;
class netif rawip_send;
class capability net_raw;
')

#######################################
#
# corenetwork_receive_raw_on_$1_interface(domain,[`optional'])
#
define(`corenetwork_receive_raw_on_$1_interface',`
requires_block_template(`corenetwork_receive_raw_on_$1_interface_depend',dollarstwo)
allow dollarsone $1_netif_t:netif rawip_recv;
')

define(`corenetwork_receive_raw_on_$1_interface_depend',`
type $1_netif_t;
class netif rawip_recv;
')
'') dnl end create_netif_interfaces

########################################
#
# Network node generated macros 
#
########################################

define(`create_node_interfaces',``
#######################################
#
# corenetwork_network_tcp_on_$1_node(domain,[`optional'])
#
define(`corenetwork_network_tcp_on_$1_node',`
requires_block_template(`corenetwork_network_tcp_on_$1_node_depend',dollarstwo)
allow dollarsone $1_node_t:node { tcp_send tcp_recv };
')

define(`corenetwork_network_tcp_on_$1_node_depend',`
type $1_node_t;
class node { tcp_send tcp_recv };
')

#######################################
#
# corenetwork_network_udp_on_$1_node(domain,[`optional'])
#
define(`corenetwork_network_udp_on_$1_node',`
requires_block_template(`corenetwork_network_udp_on_$1_node_depend',dollarstwo)
corenetwork_send_udp_on_$1_node(dollarsone,dollarstwo)
corenetwork_receive_udp_on_$1_node(dollarsone,dollarstwo)
')

define(`corenetwork_network_udp_on_$1_node_depend',`
corenetwork_send_udp_on_$1_node_depend
corenetwork_receive_udp_on_$1_node_depend
')

#######################################
#
# corenetwork_network_raw_on_$1_node(domain,[`optional'])
#
define(`corenetwork_network_raw_on_$1_node',`
requires_block_template(`corenetwork_network_raw_on_$1_node_depend',dollarstwo)
corenetwork_send_raw_on_$1_node(dollarsone,dollarstwo)
corenetwork_receive_raw_on_$1_node(dollarsone,dollarstwo)
')

define(`corenetwork_network_raw_on_$1_node_depend',`
corenetwork_send_raw_on_$1_node_depend
corenetwork_receive_raw_on_$1_node_depend
')

#######################################
#
# corenetwork_send_udp_on_$1_node(domain,[`optional'])
#
define(`corenetwork_send_udp_on_$1_node',`
requires_block_template(`corenetwork_send_udp_on_$1_node_depend',dollarstwo)
allow dollarsone $1_node_t:node udp_send;
')

define(`corenetwork_send_udp_on_$1_node_depend',`
type $1_node_t;
class node udp_send;
')

#######################################
#
# corenetwork_receive_udp_on_$1_node(domain,[`optional'])
#
define(`corenetwork_receive_udp_on_$1_node',`
requires_block_template(`corenetwork_receive_udp_on_$1_node_depend',dollarstwo)
allow dollarsone $1_node_t:node udp_recv;
')

define(`corenetwork_receive_udp_on_$1_node_depend',`
type $1_node_t;
class node udp_recv;
')

#######################################
#
# corenetwork_send_raw_on_$1_node(domain,[`optional'])
#
define(`corenetwork_send_raw_on_$1_node',`
requires_block_template(`corenetwork_send_raw_on_$1_node_depend',dollarstwo)
allow dollarsone $1_node_t:node rawip_send;
allow dollarsone self:capability net_raw;
')

define(`corenetwork_send_raw_on_$1_node_depend',`
type $1_node_t;
class node rawip_send;
class capability net_raw;
')

#######################################
#
# corenetwork_receive_raw_on_$1_node(domain,[`optional'])
#
define(`corenetwork_receive_raw_on_$1_node',`
requires_block_template(`corenetwork_receive_raw_on_$1_node_depend',dollarstwo)
allow dollarsone $1_node_t:node rawip_recv;
')

define(`corenetwork_receive_raw_on_$1_node_depend',`
type $1_node_t;
class node rawip_recv;
')

#######################################
#
# corenetwork_bind_tcp_on_$1_node(domain,[`optional'])
#
define(`corenetwork_bind_tcp_on_$1_node',`
requires_block_template(`corenetwork_bind_tcp_on_$1_node_depend',dollarstwo)
allow dollarsone $1_node_t:tcp_socket node_bind;
')

define(`corenetwork_bind_tcp_on_$1_node_depend',`
type $1_node_t;
class tcp_socket node_bind;
')

#######################################
#
# corenetwork_bind_udp_on_$1_node(domain,[`optional'])
#
define(`corenetwork_bind_udp_on_$1_node',`
requires_block_template(`corenetwork_bind_udp_on_$1_node_depend',dollarstwo)
allow dollarsone $1_node_t:udp_socket node_bind;
')

define(`corenetwork_bind_udp_on_$1_node_depend',`
type $1_node_t;
class udp_socket node_bind;
')
'') dnl end create_node_interfaces

########################################
#
# Network port generated macros 
#
########################################

define(`create_port_interfaces',``
#######################################
#
# corenetwork_network_tcp_on_$1_port(domain,[`optional'])
#
define(`corenetwork_network_tcp_on_$1_port',`
requires_block_template(`corenetwork_network_tcp_on_$1_port_depend',dollarstwo)
allow dollarsone $1_port_t:tcp_socket { send_msg recv_msg };
')

define(`corenetwork_network_tcp_on_$1_port_depend',`
type $1_port_t;
class tcp_socket { send_msg recv_msg };
')

#######################################
#
# corenetwork_network_udp_on_$1_port(domain,[`optional'])
#
define(`corenetwork_network_udp_on_$1_port',`
requires_block_template(`corenetwork_network_udp_on_$1_port_depend',dollarstwo)
corenetwork_send_udp_on_$1_port(dollarsone,dollarstwo)
corenetwork_receive_udp_on_$1_port(dollarsone,dollarstwo)
')

define(`corenetwork_network_udp_on_$1_port_depend',`
corenetwork_send_udp_on_$1_port_depend
corenetwork_receive_udp_on_$1_port_depend
')

#######################################
#
# corenetwork_send_udp_on_$1_port(domain,[`optional'])
#
define(`corenetwork_send_udp_on_$1_port',`
requires_block_template(`corenetwork_send_udp_on_$1_port_depend',dollarstwo)
allow dollarsone $1_port_t:udp_socket send_msg;
')

define(`corenetwork_send_udp_on_$1_port_depend',`
type $1_port_t;
class udp_socket send_msg;
')

#######################################
#
# corenetwork_receive_udp_on_$1_port(domain,[`optional'])
#
define(`corenetwork_receive_udp_on_$1_port',`
requires_block_template(`corenetwork_receive_udp_on_$1_port_depend',dollarstwo)
allow dollarsone $1_port_t:udp recv_msg;
')

define(`corenetwork_receive_udp_on_$1_port_depend',`
type $1_port_t;
class udp_socket recv_msg;
')

#######################################
#
# corenetwork_bind_tcp_on_$1_port(domain,[`optional'])
#
define(`corenetwork_bind_tcp_on_$1_port',`
requires_block_template(`corenetwork_bind_tcp_on_$1_port_depend',dollarstwo)
allow dollarsone $1_port_t:tcp_socket name_bind;
$2
')

define(`corenetwork_bind_tcp_on_$1_port_depend',`
type $1_port_t;
class tcp_socket name_bind;
$3
')

#######################################
#
# corenetwork_bind_udp_on_$1_port(domain,[`optional'])
#
define(`corenetwork_bind_udp_on_$1_port',`
requires_block_template(`corenetwork_bind_udp_on_$1_port_depend',dollarstwo)
allow dollarsone $1_port_t:udp_socket name_bind;
$2
')

define(`corenetwork_bind_udp_on_$1_port_depend',`
type $1_port_t;
class udp_socket name_bind;
$3
')
'') dnl end create_port_interfaces

#
# network_interface(linux_interfacename)
#
define(`network_interface',`
ifdef(`interface_pass',`
create_netif_interfaces($1)
',`
type $1_netif_t alias netif_$1_t, netif_type;
requires_block_template(`type unlabeled_t')
netifcon $1 system_u:object_r:$1_netif_t system_u:object_r:unlabeled_t
')
')

#
# network_node(node_name,address,netmask)
#
define(`network_node',`
ifdef(`interface_pass',`
create_node_interfaces($1)
',`
type $1_node_t alias node_$1_t, node_type;
nodecon $2 $3 system_u:object_r:$1_node_t
')
')

define(`determine_reserved_capability',`dnl
ifelse(eval($2 < 1024),1,``allow' dollarsone self:capability net_bind_service;',`dnl
ifelse($3,`',`',`determine_reserved_capability(shiftn(2,$*))')dnl end inner ifelse
')dnl end outer ifelse
') dnl end determine reserved capability

define(`determine_reserved_capability_depend',`dnl
ifelse(eval($2 < 1024),1,`class capability net_bind_service;',`dnl
ifelse($3,`',`',`determine_reserved_capability_depend(shiftn(2,$*))')dnl end inner ifelse
')dnl end outer ifelse
') dnl end determine reserved capability depend

define(`declare_ports',`dnl
ifelse(eval($3 < 1024),1,`typeattribute $1 reserved_port_type;',`dnl')
portcon $2 $3 system_u:object_r:$1
ifelse(`$4',`',`',`declare_ports($1,shiftn(3,$*))')dnl
')

#
# network_port(port_name,protocol portnum [,protocol portnum[,...]])
#
define(`network_port',`
ifdef(`interface_pass',`
create_port_interfaces($1,determine_reserved_capability(shift($*)),determine_reserved_capability_depend(shift($*)))
',`
type $1_port_t, port_type;
declare_ports($1_port_t,shift($*))
')
')
